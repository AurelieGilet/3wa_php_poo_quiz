const questionAjaxCall=()=>{function filterQuestionsByCategory(button){const categoryId=button.dataset.categoryId;const questionBloc=document.getElementById("category-questions");const xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(this.readyState===4){if(this.status===200){questionBloc.innerHTML=this.responseText}else{questionBloc.innerHTML="Une erreur s'est produite, merci de contacter l'administrateur du site."}}};xhr.open("GET","/admin/questions/"+categoryId);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send()}
const categoriesFilters=document.querySelectorAll('[data-controls="category-filter"]');if(categoriesFilters.length){categoriesFilters.forEach((button)=>{button.addEventListener("click",()=>filterQuestionsByCategory(button))})}};questionAjaxCall();const answerQuestionsAjaxCall=()=>{function displayNextQuestion(progress){const selectedAnswer=document.querySelector("input[name=answer]:checked");if(selectedAnswer===null){const errors=document.getElementById("errors");const errorMessage="Vous devez sélectionner une réponse !";errors.innerHTML=errorMessage;return}
const answer=document.querySelector("input[name=answer]:checked").value;const gameBloc=document.getElementById("game-question");console.log(progress);const xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(this.readyState===4){if(this.status===200){if(progress<9){gameBloc.innerHTML=this.responseText}else{const parser=new DOMParser();const dom=parser.parseFromString(xhr.responseText,"text/html");document.getElementsByTagName("body")[0].innerHTML=dom.getElementsByTagName("body")[0].innerHTML;window.history.pushState(null,"",this.responseURL)}}else{gameBloc.innerHTML="Une erreur s'est produite, merci de contacter l'administrateur du site."}}};xhr.open("GET","/jeu/categorie/reponse/"+answer);xhr.send()}
const validateAnswerButton=document.getElementById("validate-answer");if(validateAnswerButton){validateAnswerButton.addEventListener("click",(event)=>{event.preventDefault();const gameProgress=document.getElementById("game-progress");if(gameProgress.dataset.progress<=9){displayNextQuestion(gameProgress.dataset.progress)}})}};answerQuestionsAjaxCall();const userScoreAjaxCall=()=>{function filterUserScoresByCategory(button,pageNumber=1){const categoryId=button.dataset.categoryId;const scoresBloc=document.getElementById("category-scores");if(pageNumber==="false"){console.log('function',pageNumber);return}
const xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(this.readyState===4){if(this.status===200){scoresBloc.innerHTML=this.responseText;addPaginationListener()}else{scoresBloc.innerHTML="Une erreur s'est produite, merci de contacter l'administrateur du site."}}};xhr.open("GET","/espace-utilisateur/scores/"+categoryId+"?page="+pageNumber);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.send()}
function addPaginationListener(){const prevButton=document.getElementById('pagination-prev');const nextButton=document.getElementById('pagination-next');console.log(prevButton);console.log(nextButton);if(prevButton){const activeCategory=document.querySelector('.active[data-controls="user-score-filter"]');const pageNumber=prevButton.dataset.prevPage;console.log('PrevPageNumber',pageNumber);prevButton.addEventListener('click',()=>filterUserScoresByCategory(activeCategory,pageNumber))}
if(nextButton){const activeCategory=document.querySelector('.active[data-controls="user-score-filter"]');const pageNumber=nextButton.dataset.nextPage;console.log('NextPageNumber',pageNumber);nextButton.addEventListener('click',()=>filterUserScoresByCategory(activeCategory,pageNumber))}}
addPaginationListener();const scoreFilters=document.querySelectorAll('[data-controls="user-score-filter"]');if(scoreFilters.length){scoreFilters.forEach((button)=>{button.addEventListener("click",()=>filterUserScoresByCategory(button))})}};userScoreAjaxCall();function changeActiveCategory(button,categoryFilterButtons){categoryFilterButtons.forEach((filterButton)=>{filterButton.classList.remove('active')});button.classList.add('active')}
const categoryFilterButtons=document.querySelectorAll('[data-component="category-filter"]');if(categoryFilterButtons.length){categoryFilterButtons.forEach((button)=>{button.addEventListener('click',()=>changeActiveCategory(button,categoryFilterButtons))})};function handleClickOutsideSelect(event){const customSelect=document.querySelector(".custom-select");if(!customSelect.contains(event.target)){customSelect.classList.remove("open");document.removeEventListener("click",handleClickOutsideSelect)}}
function changeSelectedOption(option,customSelectOptions){customSelectOptions.forEach((selectOption)=>{selectOption.classList.remove("active")});option.classList.add("active");const selectTrigger=document.querySelector(".custom-select__trigger span");if(selectTrigger){selectTrigger.textContent=option.textContent}}
const customSelectWrapper=document.querySelector(".custom-select__wrapper");const customSelect=document.querySelector(".custom-select");if(customSelectWrapper&&customSelect){customSelectWrapper.addEventListener("click",function(){customSelect.classList.toggle("open");document.addEventListener("click",handleClickOutsideSelect)})}
const customSelectOptions=document.querySelectorAll(".select-option");if(customSelectOptions.length){customSelectOptions.forEach((option)=>{option.addEventListener("click",()=>changeSelectedOption(option,customSelectOptions))})};function isTextToLong(text){if(text.innerHTML.trim().length>18){return!0}
return!1}
function truncateText(text){const truncatedText=text.innerHTML.trim().substring(0,18)+"...";console.log(truncatedText);text.innerHTML=truncatedText}
function addTitleAttribute(text){text.setAttribute("title",text.innerHTML.trim())}
const textToTruncate=document.querySelectorAll('[data-truncate="true"]');if(textToTruncate.length){textToTruncate.forEach((text)=>{if(isTextToLong(text)){addTitleAttribute(text);truncateText(text)}})};function handleClickOutsideMenu(event){const{target}=event;if(!target.matches('#options-menu, #nav-options')){const optionsButton=document.getElementById('nav-options');toggleMobileMenu(optionsButton)}}
function toggleMobileMenu(optionsButton){const expanded=optionsButton.getAttribute('aria-expanded')==='true';optionsButton.setAttribute('aria-expanded',String(!expanded));if(expanded){optionsButton.classList.replace('icon-options-hover','icon-options');optionsMenu.classList.remove('show');document.removeEventListener('click',handleClickOutsideMenu)}else{optionsButton.classList.replace('icon-options','icon-options-hover');optionsMenu.classList.add('show');document.addEventListener('click',handleClickOutsideMenu)}}
const optionsButton=document.getElementById('nav-options');const optionsMenu=document.getElementById('options-menu');if(optionsButton){optionsButton.addEventListener('click',()=>{toggleMobileMenu(optionsButton)})}
window.addEventListener('resize',()=>{optionsButton.classList.replace('icon-options-hover','icon-options');optionsButton.setAttribute('aria-expanded','false');optionsMenu.classList.remove('show');document.removeEventListener('click',handleClickOutsideMenu)})